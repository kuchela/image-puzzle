
<!DOCTYPE html>
<html>
<head>
<title>Image Puzzle</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial; text-align: center; margin: 0; padding: 0; }
  h1 { font-size: 1.5em; margin: 10px; }
  #timer, #moves { font-size: 1.2em; margin: 10px; }
  #controls { margin: 10px; }
  #puzzle {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    width: min(90vw, 400px);
    aspect-ratio: 1 / 1;
    margin: 20px auto;
    border: 2px solid #ccc;
  }
  .cell {
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  .piece {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Fill cell completely */
    display: block;
    cursor: pointer;
  }
  .selected { outline: 3px solid red; }
  button { padding: 10px 15px; font-size: 16px; cursor: pointer; margin: 5px; }
  #original { display: none; margin-top: 20px; }
  #original img { max-width: 90vw; height: auto; border: 2px solid #ccc; }

  /* Modal Styles */
  #completionModal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
    z-index: 999;
  }
  .modal-content {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    animation: popUp 0.5s ease-out;
    max-width: 400px;
    width: 90%;
  }
  @keyframes popUp {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  .modal-content h2 { font-size: 2em; color: #28a745; margin-bottom: 10px; }
  .modal-content p { font-size: 1.2em; margin-bottom: 20px; }
  .modal-content button {
    background: #28a745; color: #fff; border: none;
    padding: 10px 20px; font-size: 16px; cursor: pointer;
    border-radius: 5px; margin: 5px;
  }
  .close-btn { background: #dc3545; }

  /* Confetti Canvas */
  #confettiCanvas {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none; z-index: 1000;
  }

  /* Hearts Animation */
  .heart {
    position: fixed; font-size: 2rem;
    animation: floatUp 3s ease-out forwards;
    z-index: 1001;
  }
  @keyframes floatUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-200px) scale(1.5); opacity: 0; }
  }
</style>
</head>
<body>
<h1>Image Puzzle</h1>
<div id="timer">Time left: <span id="time">120</span>s</div>
<div id="moves">Moves: <span id="moveCount">0</span></div>
<div id="controls">
  <button onclick="shufflePieces()">Shuffle Again</button>
  <button onclick="pauseTimer()">Pause</button>
  <button onclick="resumeTimer()">Resume</button>
</div>
<div id="puzzle"></div>
<div id="original">
  <h2>Original Image</h2>
  original.jpg
</div>

<!-- Completion Modal -->
<div id="completionModal">
  <div class="modal-content">
    <h2>ðŸŽ‰ Puzzle Solved! ðŸŽ‰</h2>
    <p>You completed the puzzle in <span id="finalMoves"></span> moves!</p>
    <button onclick="playAgain()">Play Again</button>
    <button class="close-btn" onclick="closeModal()">Close</button>
  </div>
</div>

<!-- Confetti Canvas -->
<canvas id="confettiCanvas"></canvas>

<script>
const pieces = [
  "piece_0_0.png","piece_0_1.png","piece_0_2.png",
  "piece_1_0.png","piece_1_1.png","piece_1_2.png",
  "piece_2_0.png","piece_2_1.png","piece_2_2.png"
];

let selectedPiece = null;
let timeLeft = 120;
let timer = setInterval(updateTimer, 1000);
let paused = false;
let moveCount = 0;

function updateTimer() {
  if (!paused) {
    timeLeft--;
    document.getElementById('time').innerText = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timer);
      showCelebration(true);
    }
  }
}

function renderPuzzle(order) {
  const puzzle = document.getElementById('puzzle');
  puzzle.innerHTML = '';
  order.forEach(id => {
    const cell = document.createElement('div');
    cell.className = 'cell';
    const img = document.createElement('img');
    img.src = id;
    img.id = id;
    img.className = 'piece';
    img.onclick = () => selectPiece(img);
    cell.appendChild(img);
    puzzle.appendChild(cell);
  });
}

function selectPiece(piece) {
  if (!selectedPiece) {
    selectedPiece = piece;
    piece.classList.add('selected');
  } else {
    const tempParent = piece.parentNode;
    const selectedParent = selectedPiece.parentNode;
    selectedParent.appendChild(piece);
    tempParent.appendChild(selectedPiece);
    selectedPiece.classList.remove('selected');
    selectedPiece = null;
    moveCount++;
    document.getElementById('moveCount').innerText = moveCount;
    checkSolved();
  }
}

function shufflePieces() {
  const shuffled = [...pieces].sort(() => Math.random() - 0.5);
  renderPuzzle(shuffled);
  moveCount = 0;
  document.getElementById('moveCount').innerText = moveCount;
}

function checkSolved() {
  const currentOrder = Array.from(document.querySelectorAll('#puzzle img')).map(p => p.id);
  if (JSON.stringify(currentOrder) === JSON.stringify(pieces)) {
    clearInterval(timer);
    document.getElementById('timer').style.display = 'none';
    document.getElementById('original').style.display = 'block';
    showCelebration(false);
  }
}

function pauseTimer() { paused = true; }
function resumeTimer() { paused = false; }

function showCelebration(timeUp) {
  document.getElementById('completionModal').style.display = 'flex';
  document.getElementById('finalMoves').innerText = timeUp ? "Time's up!" : moveCount;
  startConfetti();
  startHearts();
  setTimeout(stopConfetti, 10000);
}

function playAgain() { location.reload(); }
function closeModal() { document.getElementById('completionModal').style.display = 'none'; }

/* Confetti Animation */
const canvas = document.getElementById('confettiCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let confetti = [];
let confettiAnimation;

function startConfetti() {
  confetti = Array.from({length: 150}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height - canvas.height,
    r: Math.random() * 6 + 2,
    d: Math.random() * 2 + 1,
    color: `hsl(${Math.random() * 360}, 100%, 50%)`
  }));
  confettiAnimation = requestAnimationFrame(drawConfetti);
}

function drawConfetti() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  confetti.forEach(c => {
    ctx.beginPath();
    ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
    ctx.fillStyle = c.color;
    ctx.fill();
    c.y += c.d;
    if (c.y > canvas.height) c.y = -10;
  });
  confettiAnimation = requestAnimationFrame(drawConfetti);
}

function stopConfetti() {
  cancelAnimationFrame(confettiAnimation);
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

/* Hearts Animation */
function startHearts() {
  const colors = ['red', 'pink', 'purple', 'gold'];
  const interval = setInterval(() => {
    for (let i = 0; i < 5; i++) {
      const heart = document.createElement('div');
      heart.className = 'heart';
      heart.textContent = 'â¤ï¸';
      heart.style.color = colors[Math.floor(Math.random() * colors.length)];
      heart.style.left = Math.random() * window.innerWidth + 'px';
      heart.style.top = window.innerHeight + 'px';
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 3000);
    }
  }, 500);
  setTimeout(() => clearInterval(interval), 5000);
}

shufflePieces();
</script>
</body>
</html>
